
const escapeWifi = (value) => value?.replace(/([\\;,:"])/g, "\\$1");

export const define = (ir) => {
    ir.defineFields("main", {
        ssid: { type: "text", req: true },
        encryption: { type: "enum", enm: ["WPA", "WEP", "nopass"], fb: "WPA" },
        password: {
            type: "text",
            showIf: ({ encryption }) => encryption !== "nopass",
            req: ({ encryption }) => encryption !== "nopass"
        },
        hidden: { type: "boolean", fb: false }
    });
};

export const format = ({ computed:{ ssid, encryption, hidden, password }}) => {
    ssid = escapeWifi(ssid);
    hidden = hidden ? "true" : "";
    password = encryption === "nopass" ? "" : escapeWifi(password);

    const parts = [
        "WIFI:",
        `T:${encryption};`,
        `S:${ssid};`,
        password ? `P:${password};` : "",
        hidden ? `H:${hidden};` : "",
        ";"
    ];

    return {
        body:parts.join(""),
        title:`WiFi: ${ssid}`
    }
};
